source("~/Documents/SISE/Serie temporelle/Projet/Elecseries/R/test.R")
source("~/Documents/SISE/Serie temporelle/Projet/Elecseries/R/test.R")
View(elec)
dat <- read.csv("../Elec-train.csv")
dat$Timestamp <- as.POSIXct(dat$Timestamp, format = "%m/%d/%Y %H:%M", tz = "UTC")
freq <- 96
quarter <- function(x)
4*as.integer(format(x, "%H")) + as.integer(format(x, "%M"))/15 + 1
start.t <- c(as.integer(format(dat$Timestamp[1], "%Y")),  quarter(dat$Timestamp[1]))
end.t   <- c(as.integer(format(dat$Timestamp[nrow(dat)], "%Y")), quarter(dat$Timestamp[nrow(dat)]))
pow.ts <- ts(dat$Power, frequency = freq, start = start.t, end = end.t)
temp.ts <- ts(dat$Temp,  frequency = freq, start = start.t, end = end.t)
dat <- read.csv("../Elec-train.csv")
dat$Timestamp <- as.POSIXct(dat$Timestamp, format = "%m/%d/%Y %H:%M", tz = "UTC")
freq <- 96
quarter <- function(x)
4*as.integer(format(x, "%H")) + as.integer(format(x, "%M"))/15 + 1
start.t <- c(as.integer(format(dat$Timestamp[1], "%Y")),  quarter(dat$Timestamp[1]))
end.t   <- c(as.integer(format(dat$Timestamp[nrow(dat)], "%Y")), quarter(dat$Timestamp[nrow(dat)]))
pow.ts <- ts(dat$Power, frequency = freq, start = start.t, end = end.t)
temp.ts <- ts(dat$Temp,  frequency = freq, start = start.t, end = end.t)
dat <- read.csv("../Elec-train.csv")
dat$Timestamp <- as.POSIXct(dat$Timestamp, format = "%m/%d/%Y %H:%M", tz = "UTC")
freq <- 96
quarter <- function(x)
4*as.integer(format(x, "%H")) + as.integer(format(x, "%M"))/15 + 1
start.t <- c(as.integer(format(dat$Timestamp[1], "%Y")),  quarter(dat$Timestamp[1]))
end.t   <- c(as.integer(format(dat$Timestamp[nrow(dat)], "%Y")), quarter(dat$Timestamp[nrow(dat)]))
elec <- list(
power = ts(dat$Power, frequency = freq, start = start.t, end = end.t)
temp = ts(dat$Temp,  frequency = freq, start = start.t, end = end.t)
elec <- list(
power = ts(dat$Power, frequency = freq, start = start.t, end = end.t),
temp = ts(dat$Temp,  frequency = freq, start = start.t, end = end.t)
)
start.t
end.t
save(elec, file = "elec")
save(elec, file = "data/elec.rda")
plot(elec)
autoplot(elec)
plot(elec$power)
plot(elec$temp)
freq <- 52*7*24*4
quarter <- function(x)
4*as.integer(format(x, "%H")) + as.integer(format(x, "%M"))/15 + 1
start.t <- c(as.integer(format(dat$Timestamp[1], "%Y")),  quarter(dat$Timestamp[1]))
end.t   <- c(as.integer(format(dat$Timestamp[nrow(dat)], "%Y")), quarter(dat$Timestamp[nrow(dat)]))
elec <- list(
power = ts(dat$Power, frequency = freq, start = start.t, end = end.t),
temp = ts(dat$Temp,  frequency = freq, start = start.t, end = end.t)
)
plot(elec$temp)
dat <- read.csv("../Elec-train.csv")
dat <- read.csv(".../Elec-train.csv")
dat <- read.csv("..../Elec-train.csv")
dat <- read.csv("../../Elec-train.csv")
dat$Timestamp <- as.POSIXct(dat$Timestamp, format = "%m/%d/%Y %H:%M", tz = "UTC")
freq <- 52*7*24*4
quarter <- function(x)
4*as.integer(format(x, "%H")) + as.integer(format(x, "%M"))/15 + 1
yday <- as.integer(format(dat$Timestamp, "%j"))
slot <- (yday - 1) * 96 + quarter(dat$Timestamp)
start <- c(as.integer(format(dat$Timestamp[1], "%Y")), slot[1])
end   <- c(as.integer(format(dat$Timestamp[nrow(dat)], "%Y")), slot[nrow(dat)])
elec <- list(
power = ts(dat$Power, frequency = freq, start = start, end = end)
temp = ts(dat$Temp, frequency = freq, start = start, end = end)
elec <- list(
power = ts(dat$Power, frequency = freq, start = start, end = end),
temp = ts(dat$Temp, frequency = freq, start = start, end = end)
)
plot(elec$temp)
library(fpp2)
autoplot(elec)
elec = ts(dat[, c("Power", "Temp")], frequency = freq, start = start, end = end),
library(fpp2)
dat <- read.csv("../../Elec-train.csv")
dat$Timestamp <- as.POSIXct(dat$Timestamp, format = "%m/%d/%Y %H:%M", tz = "UTC")
freq <- 52*7*24*4
quarter <- function(x)
4*as.integer(format(x, "%H")) + as.integer(format(x, "%M"))/15 + 1
yday <- as.integer(format(dat$Timestamp, "%j"))
slot <- (yday - 1) * 96 + quarter(dat$Timestamp)
elec = ts(dat[, c("Power", "Temp")], frequency = freq, start = start, end = end),
dat[, c("Power", "Temp")]
elec = ts(dat[, c("Power", "Temp")], frequency = freq, start = start, end = end)
dat[, c("Power", "Temp")]
start <- as.integer(format(dat$Timestamp[1], "%Y"))
end   <- as.integer(format(dat$Timestamp[nrow(dat)], "%Y"))
elec = ts(dat[, c("Power", "Temp")], frequency = freq, start = start, end = end)
as.integer(format(dat$Timestamp[1], "%Y")
as.integer(format(dat$Timestamp[1], "%Y"))
slot[1]
start
start <- c(as.integer(format(dat$Timestamp[1], "%Y")), slot[1])
end   <- c(as.integer(format(dat$Timestamp[nrow(dat)], "%Y")), slot[nrow(dat)])
start
elec = ts(dat[, c("Power", "Temp")], frequency = freq, start = start, end = end)
dat[, c("Power", "Temp")]
autoplot(elec)
save(elec, file = "data/elec.rda")
save(elec, file = "../data/elec.rda")
library(fpp2)
dat <- read.csv("../../Elec-train.csv")
dat$Timestamp <- as.POSIXct(dat$Timestamp, format = "%m/%d/%Y %H:%M", tz = "UTC")
freq <- 52*7*24*4
quarter <- function(x)
4*as.integer(format(x, "%H")) + as.integer(format(x, "%M"))/15 + 1
yday <- as.integer(format(dat$Timestamp, "%j"))
slot <- (yday - 1) * 96 + quarter(dat$Timestamp)
start <- c(as.integer(format(dat$Timestamp[1], "%Y")), slot[1])
temp_end   <- c(as.integer(format(dat$Timestamp[nrow(dat)], "%Y")), slot[nrow(dat)])
last_non_na_power <- tail(which(!is.na(dat[, "Power"])), 1)
power_end <- c(as.integer(format(dat$Timestamp[last_non_na_power], "%Y")), slot[last_non_na_power])
power = ts(dat[, "Power"], frequency = freq, start = start, end = power_end)
temp = ts(dat[, "Temp"], frequency = freq, start = start, end = temp_end)
autoplot(temp) + autolayer(power)
end(power)
save(power, file = "../data/power.rda")
save(temp, file = "../data/temp.rda")
library(fpp2)
library(ggplot2)
load("../data/power.rda")
load("../data/temp.rda")
autoplot(decompose(power, type='additive'))
ggseasonplot(power) +
labs(colour = "Day")
library(fpp2)
library(ggplot2)
load("../data/power.rda")
load("../data/temp.rda")
autoplot(decompose(power, type='additive'))
library(fpp2)
dat <- read.csv("../../Elec-train.csv")
dat$Timestamp <- as.POSIXct(dat$Timestamp, format = "%m/%d/%Y %H:%M", tz = "UTC")
last_power_index <- tail(which(!is.na(dat[, "Power"])), 1)
power_dat <- dat[, "Power"][1:last_power_index]
temp_dat <- dat[, "Temp"]
freq <- 4*24                       # 96 observations per day
start.date <- as.POSIXlt(dat[, "Timestamp"], tz = "UTC")
start.day  <- as.numeric(format(start.date, "%j"))
start.slot <- as.numeric(format(start.date, "%H"))*4 +
as.numeric(format(start.date, "%M"))/15 + 1
power <- ts(power_dat,
frequency = freq,
start = c(start.day, start.slot))
temp <- ts(temp_dat,
frequency = freq,
start = c(start.day, start.slot))
autoplot(temp) + autolayer(power)
start(power)
end(power)
start(temp)
end(temp)
save(power, file = "../data/power.rda")
save(temp, file = "../data/temp.rda")
library(fpp2)
library(ggplot2)
load("../data/power.rda")
load("../data/temp.rda")
autoplot(decompose(power, type='additive'))
ggseasonplot(power) +
labs(colour = "Day")
autoplot(power)
zero_idx <- which(power == 0)
length(zero_idx)
zero_times <- cbind(zero_idx %/% 96, zero_idx %% 96)
zero_times
train <- window(power, end=zero_times[1])
outlayers_fit <- auto.arima(train, truncate = 96*10)
summary(outlayers_fit)
pred <- forecast(outlayers_fit, h = 11)
autoplot(train) + autolayer(pred$mean)
pred <- forecast(outlayers_fit, h = 11)
autoplot(train) + autolayer(pred$mean)
pred$mean
clean_power <- power
#window(clean_power, start = start(pred$mean), end = end(pred$mean)) <- pred$mean
clean_power[zero_idx] <- pred$mean
autoplot(clean_power)
train <- window(clean_power, end = c(48, 96))
test <- window(clean_power, start = c(49, 1))
compute_RMSE <- function(y_pred, y_true, print=FALSE) {
rmse <- sqrt(mean((y_true - y_pred)^2))
if(print) {
paste("RMSE: ", rmse)
} else {
return(rmse)
}
}
K <- 3                        # number of harmonics you want
xreg <- fourier(train, K = K) # length = length(train), period = frequency(train)
fit <- Arima(train,
order = c(0, 2, 0),
seasonal = c(0, 0, 0),  # no seasonal AR/MA terms
xreg = xreg)
K <- 3                        # number of harmonics you want
xreg <- fourier(train, K = K) # length = length(train), period = frequency(train)
fit <- Arima(train,
order = c(0, 2, 0),
seasonal = c(0, 0, 0),  # no seasonal AR/MA terms
xreg = xreg)
summary(fit)
K <- 3                        # number of harmonics you want
xreg <- fourier(train, K = K) # length = length(train), period = frequency(train)
fit <- Arima(train,
order = c(0, 2, 0),
seasonal = c(0, 0, 0),  # no seasonal AR/MA terms
xreg = xreg)
arima_fit %>% residuals() %>% ggtsdisplay()
K <- 3                        # number of harmonics you want
xreg <- fourier(train, K = K) # length = length(train), period = frequency(train)
arima_fit <- Arima(train,
order = c(0, 2, 0),
seasonal = c(0, 0, 0),  # no seasonal AR/MA terms
xreg = xreg)
arima_fit %>% residuals() %>% ggtsdisplay()
K <- 3                        # number of harmonics you want
xreg <- fourier(train, K = K) # length = length(train), period = frequency(train)
arima_fit <- Arima(train,
order = c(0, 2, 0),
seasonal = c(0, 1, 1),  # no seasonal AR/MA terms
xreg = xreg)
ggtsdisplay(diff(diff(train, lag=96), differences = 2))
arima_fit <- Arima(train, order = c(0, 2, 0), seasonal = c(0, 1, 1))
arima_fit %>% residuals() %>% ggtsdisplay()
arima_fit <- Arima(train, order = c(0, 2, 13), seasonal = c(0, 1, 1))
train_light <- tail(train, 96*3)
arima_fit <- Arima(train_light, order = c(0, 2, 13), seasonal = c(0, 1, 1))
train_light <- tail(train, 96*3)
# arima_fit <- Arima(train_light, order = c(0, 2, 13), seasonal = c(0, 1, 1))
# arima_fit %>% residuals() %>% ggtsdisplay()
train_light <- tail(train, 96)
arima_fit <- Arima(train_light, order = c(0, 2, 0), seasonal = c(0, 1, 1))
train_light <- tail(train, 96*2)
arima_fit <- Arima(train_light, order = c(0, 2, 0), seasonal = c(0, 1, 1))
arima_fit %>% residuals() %>% ggtsdisplay()
train_light <- tail(train, 96*2)
arima_fit <- Arima(train_light, order = c(0, 2, 13), seasonal = c(0, 1, 1))
